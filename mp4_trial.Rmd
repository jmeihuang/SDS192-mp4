---
title: "mp4_trial"
output:
  html_document:
    theme: sandstone
    df_print: paged
    code_folding: "hide"
---

```{r, echo = FALSE, message=FALSE}
##loading the packages and pulling out the imdb dataset
library(tidyverse)
library(RMySQL)
db <- dbConnect(MySQL(), 
                host = "scidb.smith.edu", 
                user = "mth292", 
                password = "RememberPi", 
                dbname = "imdb")
knitr::opts_chunk$set(connection = db, max.print = 20)
```

```{r}
##filtering the movie_id that Weinstein produced ----
movie_id <- dbGetQuery(db, 'SELECT ci.movie_id, t.production_year
FROM imdb.cast_info ci
join name n on n.id = ci.person_id
join title t on t.id = ci.movie_id
join role_type r on r.id = ci.role_id
where n.id = 2551650
and r.id = 3
order by production_year desc;')
```

##Top male dominated genres
```{r}
test <- dbGetQuery(db, 'SELECT count(ci.movie_id) as total, m.info
FROM imdb.cast_info ci
join name n on n.id = ci.person_id
join title t on t.id = ci.movie_id 
join role_type r on r.id = ci.role_id
join movie_info m on m.movie_id = ci.movie_id
where n.gender = "m"
and m.info_type_id =3
and r.id = 3
and t.production_year > 2010
group by m.info
order by total desc
limit 0,5;')
```

##Total number of movies produced by men since 2010
```{r}
ggplot (data =test, aes(x = info,y = total, fill = info))+
  geom_bar(stat = "identity")+
  theme(legend.position = "None")
```



```{r}
#Trying to get the women producers 

female_producers <- dbGetQuery(db, 'SELECT ci.id, ci.movie_id, t.title,  mi.info, t.production_year, n.name, n.gender, r.id
FROM imdb.cast_info ci
join name n on n.id = ci.person_id
join title t on t.id = ci.movie_id
join movie_info mi on mi.movie_id = ci.movie_id
join role_type r on r.id = ci.role_id
where n.gender like \'f\'
AND r.id = 8
AND mi.info_type_id = 3;')
```



